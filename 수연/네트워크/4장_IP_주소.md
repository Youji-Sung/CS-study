## 3계층의 기능

IP주소는 3계층에서 사용하는 주소이다.

cf) MAC주소는 2계층에서 사용하는 주소이다.

IP주소는 MAC주소에 비해 복잡하다.



### 3계층에서 하는 일

3계층은 **다른 네트워크 대역** 즉, 멀리 떨어진 곳에 존재하는 **네트워크**까지 어떻게 데이터를 전달할지 제어하는 일을 담당한다.

* LAN과 LAN을 연결하면 WAN이 된다.
* LAN과 LAN을 연결해주는 것이 3계층의 역할이다.
* 3계층의 대표적인 장비 '라우터' cf) 스위치는 2계층 장비
  * LAN과 LAN, 서로 다른 네트워크 대역 연결하기 위해서는 '라우터'와 같은 장비가 필요하다.

발신에서 착신까지의 패킷의 경로를 제어한다.



### 3계층에서 쓰는 주소

WAN에서 통신할 때 사용하는 IP 주소

IP주소또한 `ipconfig`을 통해서 확인할 수 있다.

멀리 있는 곳과 통신하기 위해서는 IPv4뿐만 아니라 추가적으로 서브넷 마스크, 게이트웨이 주소가 필요하다.

* IPv4주소: 현재 PC에 할당된 IP주소
* 서브넷 마스크: IP주소에 대한 네트워크의 대역을 규정하는 것
* 게이트웨이 주소: 외부와 통신할 떄 사용하는 네트워크의 출입구



### 3계층 프로토콜

3계층 프로토콜은 종류만 확인하고 넘어갈 것

IP주소를 이용해 MAC주소를 알아오는 **ARP프로토콜**

WAN에서 통신할 때 사용하는 **IPv4 프로토콜**

* IPv6은 구조자체가 다르다.

서로가 통신되는지 확인할 때 사용하는 **ICMP 프로토콜**



## 일반적인 IP 주소

### Classful IP 주소

낭비가 심한 Classful IP 주소

* 4개의 필드로 구성되어 있고 '.'으로 구분한다.
* 4 byte, 10진수(0~255)
* cf) MAC주소는 6개로 구성 ':'로 구분  6byte

![image-20220912202029305](4%EC%9E%A5_IP_%EC%A3%BC%EC%86%8C.assets/image-20220912202029305.png)

[10진수]

0.0.0.0																  255.255.255.255

[2진수]

00000000.00000000.00000000.00000000	11111111.11111111.11111111.11111111



A클래스: 네트워크를 부분할 수 있는 대역 가장 적다. 한 대역에 속해있는 PC의 수는 가장 많다.

(첫번째 필드까지 네트워크 구분에 사용, 나머지 세개 필드가 그 안에 속한 컴퓨터를 구분하는 것에 사용)

[B,C 클래스는 위 표를 참고]



D클래스: 멀티캐스트를 위해 남겨둔 클래스

E클래스: 실험을 위해 남겨둔 클래스



✔ 문제 발생

IP주소가 부족해지는 상황이 발생했고 이는 사용하지 못하고 낭비되는 IP주소 때문이었다.



### Classless IP 주소

낭비되지 않도록 아껴쓰는 Classless IP 주소

![image-20220913000759340](4%EC%9E%A5_IP_%EC%A3%BC%EC%86%8C.assets/image-20220913000759340.png)

원하는 구간으로 잘라서 사용할 수 있도록 한 것이 Classless방식이다.

서브넷 마스크는 네트워크 대역을 보조하여 네트워크 대역을 어디서부터 구분할 것인지 지정하는 것이다.

**IP주소**는 **항상 서브넷 마스크**와 함께 쓴다.



기존 '.'으로 구분하던 것이 아니라 서브넷마스크로 구분하는 방법

**서브넷 마스크**

네트워크 대역을 나눠주는데 사용하는 값

어디까지가 네트워크 대역을 구분하는데 사용하고 어디서부터 호스트를 구분하는데 사용하는지를 지정한다.

2진수로 표기했을 때 1로 시작, 1과 1사이에는 0이 올 수 없다는 규칙을 가지고 있다.

1에서 0으로 바뀌는 부분을 기준으로 네트워크 대역을 구분하는 값에서 그 네트워크안의 컴퓨터를 구분하는 값이다.



Q. 11111111.11111111.11111111.11000000인 경우 하나의 네트워크 대역에 들어갈 수 있는 컴퓨터의 개수는?

64대



### 사설IP와 공인IP

공인IP 1개당 2^32개의 사설 IP

![image-20220913002107707](4%EC%9E%A5_IP_%EC%A3%BC%EC%86%8C.assets/image-20220913002107707.png)

현재는 classless와 사설IP, 공인IP을 함께 쓰고 있다.

**공인IP**

실제 네트워크 통신망과 통신할 때 사용하는 IP주소

**사설IP**

같은 네트워크 대역에서 사용하는 IP주소



사설 IP 대역에서 사용하고 있는 장비들은 네트워크 통신을 할 때 공인 IP로 바꿔서 Internet과 통신한다.

👉 네이버에 '내 ip 주소' 검색으로 확인하는 것: 공인 IP

👉 `ipconfig`을 통해 확인하는 것: 사설 IP

✔ **네트워크 주소를 사설 IP에서 공인 IP로 바꿔주는 것을 <u>NAT</u>라고 한다.**

* NAT(Network Address Translation)
* 특정 IP를 다른 특정 IP로 바꾸는 기술

요청을 통해 받은 내용은 공유기를 통해 사설IP에 전달된다.

![image-20220913003007200](4%EC%9E%A5_IP_%EC%A3%BC%EC%86%8C.assets/image-20220913003007200.png)

공유기가 처리해주는 것.

사설IP에서 공인IP로 나갈 때 어떤 요청을 보냈는지 NAT테이블에 기록한다.

**만약,** 나간 적이 없는 패킷이 공유기를 통해 들어온 경우?

공유기에서 받고 다른 내부 컴퓨터에 전달 없이 끝난다.

✔ Port-Forwarding을 하면 외부에서 내부로 들어올 수 있다.



## 특수한 IP 주소

### 0.0.0.0

Wildcard

나머지 모든 ip

일반적으로 컴퓨터에 사용하지 않는 것이다.

![image-20220913003746617](4%EC%9E%A5_IP_%EC%A3%BC%EC%86%8C.assets/image-20220913003746617.png)



### 127.0.0.1

나 자신을 나타내는 주소

![image-20220913003904161](4%EC%9E%A5_IP_%EC%A3%BC%EC%86%8C.assets/image-20220913003904161.png)



### 게이트웨이 주소

어딘가로 가려면 일단 여기로

일반적으로 공유기 ip주소를 적는다.

(이 네트워크 대역에서 쓸 수 있는 가장 작은 ip 혹은 가장 큰 ip을 사용한다.)

공유기에 WAN이라고 쓰여진 곳이 있는데 그 곳이 외부에서 들어오는 인터넷 선이고 나머지는 사설IP에서 사용하는 선을 꼽는 것이다.

![image-20220913003932412](4%EC%9E%A5_IP_%EC%A3%BC%EC%86%8C.assets/image-20220913003932412.png)



기본적으로 3가지가 설정이 되어야 인터넷 사용이 가능하다.

✔ IPv4

✔ 서브넷마스크

✔ 게이트웨이