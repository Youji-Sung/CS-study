# NAT와 포트포워딩



## NAT란?

NAT(Natwork Address Translation)은 IP 패킷의 TCP/UDP 포트 숫자와 소스 및 목적지의 IP 주소 등을 재기록 하면서 라우터를 통해 네트워크 프래픽을 주고 받는 기술을 말한다.

패킷에 변화가 생기기 때문에 IP나 TCP/UDP의 Checksum도 다시 계산되어 재기록해야 한다.

NAT를 이용하는 이유는 대개 사설 네트워크에 속한 여러개의 호스트가 하나의 공인 IP주소를 사용하여 인터넷에 접속하기 위함이다.

하지만 꼭 사설IP를 공인IP로 변환 하는데에만 사용하는 기술은 아니다.



#### 인터넷 세상에서 바라본 모습 사설 IP와 공인 IP

![img](https://velog.velcdn.com/images%2Fcombi_areum%2Fpost%2Fc8af8477-8bc0-47dc-be41-ee090fbb80f1%2F%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-12-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%201.41.10.png)

사설IP대역에 pc나 노트북이 통신할 때 공유기에 할당되어 있는 공인IP로 변경되어서 통신된다.

![img](https://velog.velcdn.com/images%2Fcombi_areum%2Fpost%2Fc6c956b4-f619-492b-bb89-af1d267003f2%2F%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-12-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%201.42.35.png)

실제 바깥네트워크 세상에는 마치 공유기끼리 통신하는 것처럼 보인다.



## 포트포워딩

포트 포워딩 또는 포트 매핑 ( port mapping )은 패킷이 라우터나 방화벽과 같은 네트워크 장비를 가로지르는 동안 특정 IP주소와 포트번호의 통신 요청을 특정 다른 IP와 포트 번호로 넘겨주는 네트워크 주소변환(NAT)의 응용이다.

이 기법은 게이트웨이 ( 외부망 )의 반대쪽에 위치한 사설네트워크에 상주하는 호스트에 대한 서비스를 생성하기 위해 흔히 사용된다.



#### 특정 IP의 특정 포트로 온 요청을 포트 포워딩

![img](https://velog.velcdn.com/images%2Fcombi_areum%2Fpost%2Fb9bf41af-6afd-44ef-bd25-45d8744cc41e%2F%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-12-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.10.44.png)

공인 IP2의 특정 포트로 전송한다.

사설 IP 대역에 있는 컴퓨터가 보이지 않는 네트워크 대역으로 직접 통신하고자 한다.

컴퓨터에 포트포워딩 설정을 해야 한다.

![](https://velog.velcdn.com/images%2Fcombi_areum%2Fpost%2Fe1eb2db6-0407-4e67-aa47-c9a762b57127%2F%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-12-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.12.36.png)

패킷을 보낼 때 공인IP 2번의 특정 포트로 보내면

특정 포트로 들어온 요청을 다른 특정 IP의 특정 포트로 전송한다.

![img](https://velog.velcdn.com/images%2Fcombi_areum%2Fpost%2Fca90394d-8972-4a35-88a5-ce7737a3b9bf%2F%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA%202021-12-27%20%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE%202.13.24.png)

이러한 전달을 해주는 것을 포트포워딩이라고 한다.