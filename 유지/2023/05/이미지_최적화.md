# 이미지 최적화

[참고한 글](https://velog.io/@hustle-dev/%EC%9B%B9-%EC%84%B1%EB%8A%A5%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B5%9C%EC%A0%81%ED%99%94)
프론트엔드 개발에서 이미지 최적화란, 웹 페이지에서 사용되는 이미지의 용량 등을 변경하여 성능을 최대한 개선하는 과정을 말한다.

## 이미지 최적화를 하는 이유

- 웹 페이지의 로딩 속도를 빠르게 한다.
- 웹 페이지 로드 속도가 빨라져, 사용자 경험을 개선할 수 있다.
- 웹 페이지 바이트를 절약할 수 있다.
- 브라우저가 다운로드해야 하는 바이트가 줄어든다. 따라서, 클라이언트의 대역폭에 여유가 생긴다.
  - 대역폭이란, 네트워크에서 단위 시간당 전송 가능한 데이터 양을 의미한다. 즉, 인터넷 연결의 데이터 전송 속도를 나타내는 지표라고도 할 수 있다.
  - 대역폭이 높을수록 더 많은 데이터를 빠르게 전송할 수 있어서, 더 나은 사용자 경험을 제공할 수 있게 된다.
  - 대역폭 사용량을 줄이면, 로딩 속도 향상, 비용 절감, 서버 성능 개선, 확장성 개선 등의 이점이 발생한다.
- 필요로 하는 서버 저장공간이 줄어들어서, 비용을 절감할 수 있다.
- 구글의 SEO 순위를 결정할 때 이점이 있다.
  - 응답성이 빨라진다면, 검색 결과의 상위권에 노출될 수 있기 때문이다.

## 이미지 최적화 방법론

### 1. 이미지의 폭 조절하기(사이즈 조절하기)

### 2. 최적화된 이미지 포맷을 사용하기

- JPG, JPEG 파일은 "손실 압축"방식을 사용한다. 이미지의 일부 정보를 제거하기 때문에 품질이 손상될 수 있으나, 파일 크기가 줄어든다. 크기와 품질 사이에서 절충하기 위해 압축 정도를 선택할 수 있다.
- PNG 파일은 "무손실 압축"방식을 사용한다. 이미지의 모든 정보를 유지하면서 파일 크기를 줄이기 때문에, 용량은 일반적으로 더 크나 품질을 유지할 수 있다. 하지만, 용량이 크기 때문에 잘 사용되지는 않는 듯 하다.
- WebP는 구글이 2010년에 발표한 포맷으로 파일 크기를 줄이기 위해 손실 없는 압축과 무손실 압축을 모두 사용하고 있다. 웹사이트의 트래픽 감소 및 로딩 속도 단축을 겨냥한 것으로, 주로 사진 이미지 압축 효과가 높은 것으로 알려졌다.
- AVIF는 AOMedia에서 개발한 이미지 포맷으로, 손실 압축과 비 손실 압축을 전부 지원하기 때문에 WebP처럼 GIF, PNG, JPEG등의 상용 이미지 포맷을 대체할 수 있다. 또한 애니메이션 기능이 있어 움짤로 쓸 수 있고, 압축 효율이 뛰어나다는 점에서 WebP를 닮았다.
- JPG vs WebP vs AVIF [출처](https://velog.io/@hustle-dev/%EC%9B%B9-%EC%84%B1%EB%8A%A5%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B5%9C%EC%A0%81%ED%99%94)
  - 93%의 경우 AVIF 이미지가 WebP 이미지보다 작았다.
  - 평균적으로 AVIF 이미지는 WebP 이미지보다 47% 작았다.
  - WebP 이미지는 99%의 경우 최적화된 PNG/JPEG 이미지보다 작았다.
  - 따라서, 브라우저가 AVIF를 지원하면 AVIF를 사용하고, 그렇지 않은 경우 WebP, 그렇지 않은 경우 PNG 또는 JPEG를 사용하는 것이 좋다.

### 3. 이미지 태그에 width, height 값을 선언해 Reflow 방지하기

- reflow는 브라우저에서 DOM 요소의 크기, 위치, 스타일 등의 변화가 일어날 때 발생하는 렌더링 과정 중 하나이다.
- reflow는 변경된 요소를 기반으로 브라우저가 새로운 레이아웃을 계산하고, 이를 다시 그리는 과정을 의미한다.
- CPU 자원을 많이 사용하므로, 웹 페이지 성능을 저하시키는 요인이다.
- reflow를 막기 위해 사용할 수 있는 추가적인 방법은 아래와 같다.
  - 이미지 및 비디오 요소에 width와 height 속성을 항상 포함하거나 css를 사용하여 필요한 공간의 aspect-ratio를 잡는다.
  - CSS 속성을 변경할 때는 최대한 작은 영역에만 적용한다.
  - DOM 요소를 수정할 때는 가능한 한 한 번에 여러 개의 요소를 수정하도록 노력한다.
  - 자주 사용되는 계산 값을 캐싱하여 재사용한다.
  - reflow가 발생하지 않도록 CSS3의 transform 속성을 사용하는 것을 고려한다. transform 속성은 요소를 이동, 회전, 크기 조정 등의 변화를 줄 수 있으면서도 reflow를 발생시키지 않는다.

### 4. 여러 버전의 이미지 제공하기

- 여러 이미지 버전을 지정하면 브라우저에서 사용하기에 가장 적합한 버전을 선택한다.
- 몇 개의 이미지 버전을 만들어야 좋은지에 대해, 일반적으로 정답은 없으나 3~5개의 서로 다른 크기의 이미지를 제공한다. 더 많은 이미지 크기를 제공하면 성능은 향상되나, 그만큼 서버에서 더 많은 공간을 차지하고 HTML을 더 작성해야 하므로 상황에 맞게 고려해야 한다.

```
<img
  src="flower-large.jpg"
  srcset="flower-small.jpg 480w, flower-large.jpg 1080w"
  sizes="50vw"
/>
```

- src 속성
  - 브라우저기 srcset과 sizes 속성을 지원하지 않으면 fall back으로 src 속성이 동작한다.
  - src 속성은 모든 디바이스 크기에서 동작할 수 있을 만큼 충분히 커야한다.
- srcset 속성
  - srcset 속성은 이미지 파일명과 width 또는 density 설명을 쉼표로 구분한다.
  - width를 명시하는 것은 브라우저에 이미지의 너비를 알려주는 방법이다. 이러면 브라우저에서 크기를 결정하기 위해 이미지를 다운로드할 필요가 없다.
  - 너비를 명시하려면 px 단위 대신 w 단위를 사용한다.
- size 속성
  - 브라우저는 로드할 이미지를 결정하기 위해 유저의 디바이스 정보와 함께 size 속성의 정보를 사용한다.

### 5. 이미지 최적화 도구 사용

- 대표적인 이미지 최적화 도구로는 이미지 최적화와 리사이즈를 동시에 처리할 수 있는 Squoosh외에, sharp npm package, ImageMagick CLI tool, Thumbor, Cloudinary 등이 있다.

### 6. Image CDNs을 사용하기

- Image CDN(Content Delivery Network)를 사용하여 이미지 최적화를 할 수 있다. CDNs는 전 세계에 분산된 서버를 사용하여, 사용자가 이미지를 불러올 때 최적의 서버에서 이미지를 불러온다.
- Image CDN에서 로드된 이미지의 경우 이미지 URL은 이미지뿐만 아니라 크기, 포맷, 품질 같은 매개변수도 나타낸다. 이를 통해 다양한 사용 사례에 대한 이미지 변형을 쉽게 할 수 있다.

### 7. CSS Sprite 기법을 사용하기

- 서버로의 요청 횟수를 최소화하는 방법 중에 아주 손쉬운 방법 중 하나이다.
- 웹페이지에 필수적으로 자주 사용되는 아이콘, 버튼 같은 이미지를 쓸 때마다 여러 이미지들을 불러오는 것이 아니라, 한 이미지 파일로 통합한 후 배경 이미지로 만들어 놓고 position 값으로 각각의 이미지를 불러오는 기법이다.
- 이러한 방식으로 이미지를 불러오게 되면 트래픽이 절약되고 HTTP요청 횟수를 줄여 빠른 웹 브라우징을 할 수 있게 된다.

```
div#sprite {
  background: url(/images/sprite.png) no-repeat;
} //한 이미지를 불러옴

// position으로 각 이미지를 불러옴
div#sprite > .first {
  background-position: 0 0;
}
div#sprite > .second {
  background-position: 0 -15px;
}
div#sprite > .third {
  background-position: 0 -30px;
}
```

### 8. lazy loading 활용하기

- Lazy loading이란, 페이지를 로드할 때 모든 이미지를 로드하는 것이 아니라 중요하지 않은 자원 또는 당장 필요없는 자원의 경우, 서버에 요청을 미루고 필요한 때에 해당 자원을 요청받는 방법을 말한다.
- 서버로부터 모든 자원을 요청받지 않기 때문에 데이터 낭비를 막을 수 있고, 브라우저 렌더링 시간을 줄여준다.

### 9. 이미지 캐싱

- 이미지 캐싱을 사용하면, 이미지를 브라우저에 저장하여 이미지를 다시 로드하지 않고 빠르게 불러올 수 있게 해준다.

## 웹 사이트 성능 및 속도 분석 사이트

### [Pingdom](https://tools.pingdom.com/)

핑덤은 페이지 용량이나 다운로드 속도, 코드 분석을 통한 성능 등급과 개발 제안을 하며 웹페이지의 다이어트 진행 상황 또한 기록할 수 있어 매우 유용한 사이트이다.

### [Google PageSpeed Insights](https://pagespeed.web.dev/?utm_source=psi&utm_medium=redirect)

구글에서 운영하는 페이지 스피드 인사이트는 웹페이지의 콘텐츠를 분석하여 페이지 속도를 개선할 방법을 추천해준다.
총 페이지 용량이나 다운로드 속도 통계는 표시하지 않지만, 모바일 장치 밑 데스크탑 장치용 페이지의 성능을 측정한다.

### [Google Lighthouse](https://developer.chrome.com/docs/lighthouse/overview/)

구글의 크롬 확장 기능으로, 원하는 페이지의 속도와 관련된 문제를 파악할 수 있다.
라이트 하우스는 웹 앱의 품질을 개선하는 오픈 소스 자동화 도구로, 확인할 URL을 지정하고, 페이지에 대한 테스트를 실행한 다음, 페이지에 대한 보고서를 생성한다. 여기에서 실패한 테스트는 앱을 개선하기 위해 할 수 있는 것에 대한 지표로 사용할 수 있다.

## 느낀점

프로젝트에서 그냥 용량만 낮추려고 사이즈 줄이고, jpg형식을 사용했었는데 더 좋은 도구들이 있었다는 걸 알 수 있었다.
정말 다양한 방법으로 이미지를 최적화할 수 있다는 걸 알았다. 그리고, 통상적으로 사용되는 방법이 있지만 프로젝트에 맞게 녹여내는 게 중요하다는 것도 느꼈다. 단순하게 규칙적으로 법칙을 사용하기보다는, 이미지를 직접 바꿔가면서 분석 툴을 활용해서 우리 프로젝트에서 어떻게 사용하는 게 가장 적합한지 알아내는 게 정말 중요한 일이라는 생각이 든다.
